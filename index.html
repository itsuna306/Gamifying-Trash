<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gamifying Trash</title>
<style>
body{
  font-family: Arial;
  background:
    linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
    url("images/photo_6120774077426372264_y (1).jpg") 
    no-repeat center center fixed;
  background-size: cover;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.container{
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  padding:20px;
  border-radius:15px;
  width:400px;
  color:white;
  text-align:center;
}
input, button, textarea, select{
  width:100%;
  padding:8px;
  margin:6px 0;
  border:none;
  border-radius:5px;
}
button{
  background:white;
  color:#2E8B57;
  font-weight:bold;
  cursor:pointer;
}
button:hover{
  background:#ddd;
}
.hidden{ display:none; }
.student-card{
  background:white;
  color:black;
  padding:8px;
  margin:5px 0;
  border-radius:8px;
}
.student-card img{
  width:50px;
  height:50px;
  border-radius:50%;
  margin-right:8px;
  vertical-align:middle;
}
img.dashboard-img{
  width:120px;
  height:120px;
  border-radius:50%;
  display:block;
  margin:0 auto 10px auto;
}
.history{
  text-align:left;
  background: rgba(255,255,255,0.2);
  padding:8px;
  border-radius:5px;
  margin-top:10px;
  max-height:200px;
  overflow-y:auto;
}
.history-item{
  margin-bottom:5px;
  border-bottom:1px solid rgba(255,255,255,0.3);
  padding-bottom:3px;
}
</style>
</head>
<body>

<div class="container">

<!-- LOGIN -->
<div id="loginSection">
<h2>Login</h2>
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Password">
<button onclick="login()">Login</button>
<p>Don't have account? <a href="#" onclick="showSignup()">Sign Up</a></p>
</div>

<!-- SIGNUP -->
<div id="signupSection" class="hidden">
<h2>Sign Up</h2>
<input type="text" id="signupName" placeholder="Full Name">
<input type="email" id="signupEmail" placeholder="Email">
<input type="password" id="signupPassword" placeholder="Password">
<textarea id="signupAbout" placeholder="About you"></textarea>
<input type="file" id="signupImage" accept="image/*">
<button onclick="signup()">Create Account</button>
<p>Already have account? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<!-- STUDENT DASHBOARD -->
<div id="studentDashboard" class="hidden">
<h2>Welcome <span id="studentName"></span></h2>
<p><strong>About:</strong></p>
<p id="studentAbout"></p>
<h3>Your Points: <span id="studentPoints"></span></h3>

<div id="studentHistory" class="history"></div>

<button onclick="logout()">Logout</button>
</div>

<!-- ADMIN DASHBOARD -->
<div id="adminDashboard" class="hidden">
<h2>Admin Panel</h2>
<div id="studentList"></div>
<button onclick="logout()">Logout</button>
</div>

</div>

<script>
let currentUser = null;

// SHOW SECTIONS
function showSignup(){
  loginSection.classList.add("hidden");
  signupSection.classList.remove("hidden");
}
function showLogin(){
  signupSection.classList.add("hidden");
  loginSection.classList.remove("hidden");
}

// SIGNUP
function signup(){
  let name = signupName.value;
  let email = signupEmail.value;
  let password = signupPassword.value;
  let about = signupAbout.value;
  let imageInput = signupImage.files[0];

  let users = JSON.parse(localStorage.getItem("users")) || [];

  if(users.find(u => u.email === email)){
    alert("Email already exists!");
    return;
  }

  if(imageInput){
    let reader = new FileReader();
    reader.onload = function(){
      let imageData = reader.result;
      users.push({
        name, email, password, about,
        points:0,
        role:"student",
        image: imageData,
        history:[]
      });
      localStorage.setItem("users", JSON.stringify(users));
      alert("Account created!");
      showLogin();
    }
    reader.readAsDataURL(imageInput);
  } else {
    users.push({
      name, email, password, about,
      points:0,
      role:"student",
      image:null,
      history:[]
    });
    localStorage.setItem("users", JSON.stringify(users));
    alert("Account created!");
    showLogin();
  }
}

// LOGIN
function login(){
  let email = loginEmail.value;
  let password = loginPassword.value;
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let user = users.find(u => u.email === email && u.password === password);

  if(!user){
    alert("Invalid credentials!");
    return;
  }
  currentUser = user;
  if(user.role === "admin") showAdmin();
  else showStudent(user);
}

// STUDENT VIEW
function showStudent(user){
  loginSection.classList.add("hidden");
  signupSection.classList.add("hidden");
  studentDashboard.classList.remove("hidden");

  studentName.innerText = user.name;
  studentAbout.innerText = user.about;
  studentPoints.innerText = user.points;

  // Show profile image
  if(user.image){
    let img = document.createElement("img");
    img.src = user.image;
    img.className = "dashboard-img";
    studentDashboard.prepend(img);
  }

  // Show history
  displayHistory(user);
}

function displayHistory(user){
  let container = document.getElementById("studentHistory");
  container.innerHTML = "<h4>Point History:</h4>";
  if(user.history.length === 0){
    container.innerHTML += "<p>No points awarded yet.</p>";
    return;
  }
  user.history.forEach(h => {
    let div = document.createElement("div");
    div.className = "history-item";
    div.innerHTML = `<strong>${h.points} pts</strong> - ${h.reason}`;
    container.appendChild(div);
  });
}

// ADMIN VIEW
function showAdmin(){
  loginSection.classList.add("hidden");
  signupSection.classList.add("hidden");
  adminDashboard.classList.remove("hidden");
  loadStudents();
}

function loadStudents(){
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let students = users.filter(u => u.role === "student");
  studentList.innerHTML = "";

  if(students.length === 0){
    studentList.innerHTML = "<p>No students registered yet.</p>";
    return;
  }

  students.forEach(s => {
    if(!s.history) s.history = [];
    let div = document.createElement("div");
    div.className = "student-card";
    let imgHTML = s.image ? `<img src="${s.image}" alt="profile">` : "";

    div.innerHTML = `
      ${imgHTML}
      <strong>${s.name}</strong><br>
      Points: ${s.points}<br>
      <input type="number" id="points_${s.email}" placeholder="Points">
      <input type="text" id="reason_${s.email}" placeholder="Reason">
      <button onclick="addPoints('${s.email}')">Award Points</button>
      <button onclick="deleteStudent('${s.email}')">Delete Student</button>
      <div class="history">
        ${s.history.map(h=>`<div>${h.points} pts - ${h.reason}</div>`).join("")}
      </div>
    `;
    studentList.appendChild(div);
  });
}

// ADMIN ADD POINTS
function addPoints(email){
  let users = JSON.parse(localStorage.getItem("users"));
  let user = users.find(u => u.email === email);

  let pointsInput = parseInt(document.getElementById("points_" + email).value);
  let reasonInput = document.getElementById("reason_" + email).value;

  if(isNaN(pointsInput) || pointsInput <= 0 || reasonInput.trim() === ""){
    alert("Enter valid points and reason!");
    return;
  }

  user.points += pointsInput;
  user.history.push({points: pointsInput, reason: reasonInput});

  localStorage.setItem("users", JSON.stringify(users));
  loadStudents();
  alert("Points added successfully!");
}

// ADMIN DELETE STUDENT
function deleteStudent(email){
  if(!confirm("Are you sure you want to delete this student?")) return;

  let users = JSON.parse(localStorage.getItem("users")) || [];
  users = users.filter(u => u.email !== email);
  localStorage.setItem("users", JSON.stringify(users));
  loadStudents();
  alert("Student deleted successfully!");
}

// LOGOUT
function logout(){
  location.reload();
}

// INITIAL ADMIN ACCOUNT
(function initAdmin(){
  let users = JSON.parse(localStorage.getItem("users")) || [];
  if(!users.find(u => u.role === "admin")){
    users.push({
      name:"Admin",
      email:"admin@eco.com",
      password:"admin123",
      about:"System Admin",
      points:0,
      role:"admin",
      image:null,
      history:[]
    });
    localStorage.setItem("users", JSON.stringify(users));
  }
})();
</script>

</body>

</html>
